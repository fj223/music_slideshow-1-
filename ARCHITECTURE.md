# Документация архитектуры проекта генератора музыкальных слайд-шоу

## Обзор проекта

Это проект генератора музыкальных слайд-шоу, который позволяет преобразовать аудиофайлы в видеослайд-шоу с соответствующими изображениями. Проект реализует полный процесс преобразования аудио в видео через этапы транскрипции аудио, извлечения ключевых слов, генерации изображений и синтеза видео.

## Структура каталогов

```
music_slideshow/
├── audio_to_images.py        # Основной модуль обработки аудио в изображения
├── audio_to_video_pipeline.py # Полный процесс обработки аудио в видео
├── config.py                 # Конфигурационный файл проекта
├── main.py                   # Главный входной файл
├── requirements.txt          # Конфигурация зависимостей проекта
├── input/                    # Каталог входных файлов
│   ├── audio/                # Каталог аудиофайлов
│   └── test_audio.mp3        # Тестовый аудиофайл
├── output/                   # Каталог выходных файлов
│   ├── images/               # Сгенерированные изображения
│   ├── sentences/            # Извлеченные предложения
│   ├── transcribed/          # Результаты транскрипции аудио и извлечения ключевых слов
│   └── videos/               # Сгенерированные видеофайлы
├── logs/                     # Каталог лог-файлов
└── utils/                    # Каталог утилитных модулей
    ├── audio_processor.py    # Утилита обработки аудио
    ├── image_generator.py    # Утилита генерации изображений
    └── video_creator.py      # Утилита создания видео
```

## Описание основных модулей

### 1. Модуль обработки аудио (utils/audio_processor.py)

**Функциональность**：Обрабатывает аудиофайлы, включая транскрипцию аудио, извлечение ключевых слов и разделение на предложения.

**Основные функции**：
- Транскрипция аудио с использованием модели Whisper
- Извлечение ключевых слов из транскрибированного текста
- Разделение длинного текста на предложения
- Получение продолжительности аудио

**Основной класс**：`AudioProcessor` - инкапсулирует все функции обработки аудио.

### 2. Модуль генерации изображений (utils/image_generator.py)

**Функциональность**：Генерирует соответствующие изображения на основе текстового содержимого.

**Основные функции**：
- Принимает текстовые подсказки
- Вызывает сервис/модель генерации изображений
- Сохраняет сгенерированные изображения

**Основная функция**：`image_generator()` - Основная входная функция для генерации изображений.

### 3. Модуль создания видео (utils/video_creator.py)

**Функциональность**：Синтезирует коллекцию изображений и аудиофайл в видеослайд-шоу.

**Основные функции**：
- Создание видеослайд-шоу
- Поддержка двух режимов: фиксированная продолжительность и синхронизация с ритмом музыки
- Добавление аудио к видео
- Поддержка добавления текстовых наложений
- Обработка переходов между слайдами

**Основной класс**：`VideoCreator` - инкапсулирует все функции создания видео.

### 4. Пайплайн преобразования аудио в изображения (audio_to_images.py)

**Функциональность**：Интегрирует обработку аудио и генерацию изображений, формируя пайплайн обработки от аудио к изображениям.

**Основные функции**：
- Вызов `AudioProcessor` для обработки аудио
- Использование результатов обработки для вызова `image_generator` для генерации изображений
- Управление всем процессом обработки

**Основная функция**：`audio_to_images_pipeline()` - Полный процесс обработки от аудио к изображениям.

### 5. Полный процесс обработки (audio_to_video_pipeline.py)

**Функциональность**：Интегрирует преобразование аудио в изображения и создание видео, формируя процесс обработки "от конца до конца".

**Основные функции**：
- Вызов `audio_to_images_pipeline` для генерации изображений
- Создание видео с использованием сгенерированных изображений и исходного аудио
- Опциональное добавление текстовых наложений
- Обработка аргументов командной строки

**Основная функция**：`audio_to_video_pipeline()` - Полный процесс обработки от аудио к видео.

### 6. Модуль конфигурации (config.py)

**Функциональность**：Централизованное управление всеми конфигурационными параметрами проекта.

**Основные параметры конфигурации**：
- Конфигурация путей к файлам (каталоги ввода, вывода)
- Конфигурация обработки аудио
- Конфигурация генерации изображений
- Конфигурация создания видео

## Поток данных и процесс обработки

### Основной поток данных

1. **Входное аудио** → 2. **Транскрипция аудио** → 3. **Извлечение ключевых слов/предложений** → 4. **Генерация изображений** → 5. **Синтез видео** → 6. **Выходное видео**

### Подробный процесс обработки

1. **Входное аудио**：
   - Пользователь предоставляет путь к аудиофайлу
   - Программа проверяет существование и формат файла

2. **Транскрипция аудио**：
   - `AudioProcessor` использует модель Whisper для транскрипции аудио в текст
   - Результаты транскрипции сохраняются в каталог `output/transcribed/`

3. **Извлечение ключевых слов/предложений**：
   - В зависимости от выбора пользователя, извлекаются ключевые слова или используются полные предложения
   - Результаты извлечения сохраняются в каталог `output/transcribed/`

4. **Генерация изображений**：
   - Для каждого ключевого слова/предложения вызывается `image_generator`
   - Сгенерированные изображения сохраняются в каталог `output/images/`

5. **Синтез видео**：
   - `VideoCreator` загружает все сгенерированные изображения
   - Устанавливает продолжительность отображения каждого изображения в соответствии с конфигурацией пользователя
   - Добавляет аудио к видео
   - Опционально добавляет текстовые наложения

6. **Выходное видео**：
   - Сгенерированное видео сохраняется в каталог `output/videos/`
   - Программа выводит информацию о завершении и путь к файлу

## Технологический стек

### Основные зависимости

- **Python 3.10+** - Основной язык программирования
- **MoviePy** - Обработка и синтез видео
- **PyDub** - Обработка аудио
- **OpenAI Whisper** - Транскрипция аудио
- **Transformers** - Для обработки текста и возможной генерации изображений
- **Pillow** - Обработка изображений
- **NumPy** - Числовые вычисления

## Конфигурация и развертывание

### Установка зависимостей

```bash
pip install -r requirements.txt
```

### Основные параметры конфигурации

Все конфигурации сосредоточены в файле config.py, включая:
- Конфигурация путей к файлам
- Конфигурация параметров обработки
- Конфигурация качества вывода

## Расширяемый дизайн

Проект реализован с использованием модульного дизайна, где компоненты соединены через ясные интерфейсы, что облегчает расширение и обслуживание：

1. **Расширение обработки аудио**：Можно заменить или обновить класс `AudioProcessor` для поддержки большего числа форматов аудио или более передовых моделей транскрипции
2. **Расширение генерации изображений**：Можно интегрировать различные сервисы или модели генерации изображений
3. **Расширение видеоэффектов**：Можно добавить больше видеоэффектов и переходов в `VideoCreator`
4. **Расширение пользовательского интерфейса**：Можно добавить графический пользовательский интерфейс на основе существующего интерфейса командной строки

## Примеры использования

### Базовое использование

```bash
# Базовое преобразование аудио в видео
python audio_to_video_pipeline.py --audio "input/audio/sample.mp3" --max-images 6 --duration 4.0

# Генерация изображений с использованием ключевых слов
python audio_to_images.py --audio "input/audio/sample.mp3" --max-images 5

# Включение синхронизации с ритмом музыки
python audio_to_video_pipeline.py --audio "input/audio/sample.mp3" --beat-sync

# Добавление текстовых наложений
python audio_to_video_pipeline.py --audio "input/audio/sample.mp3" --add-text
```

## Вывод

Данный проект предоставляет полный процесс генерации видеослайд-шоу из аудио, реализованный с использованием модульного дизайна для обеспечения высокой расширяемости и поддерживаемости. Проект подходит для создания музыкальных видео, презентаций и других сценариев, где пользователь может быстро сгенерировать профессиональное аудиовизуальное содержимое с помощью простых команд командной строки.
